<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
</head>

<!--<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="css/bootstrap-table.min.css" />-->
<!--<script src="js/jquery-1.9.1.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/bootstrap-table.min.js"></script>
<script src="js/layer/layer.min.js"></script>-->
<!--<script src="js/report.js"></script>-->

<link rel="stylesheet" href="../../css/bootstrap.min.css" />
<link href="../../css/plugins/bootstrapTable/bootstrap-table.min.css" rel="stylesheet" />

<script src="../../Scripts/jquery-1.9.1.min.js"></script>
<script src="../../Scripts/jquery.cookie.js"></script>
<script src="../../Scripts/bootstrap.min.js"></script>
<script src="../../Scripts/plugins/bootstrapTable/bootstrap-table.min.js"></script>
<script src="../../Scripts/plugins/layer/layer.min.js"></script>

<script src="../../Scripts/global.js"></script>
<script src="../../Scripts/MesClient.js"></script>
<script src="../../Scripts/MesClient.UI.js"></script>

<style>
    * {
        padding: 0;
        margin: 0;
    }

    body {
        background: #fff;
        zoom:.65;
    }

    .title {
        width: 100%;
        height: 54px;
        padding: 10px 15px;
        color: #fff;
        font-size: 16px;
        font-weight: 600;
        background-color: #337ab7;
        border-radius: 3px;
        line-height: 33px;
    }

    .list {
        width: 100%;
        height: 34px;
        padding-left: 15px;
        padding-right: 15px;
        margin-top: 25px;
    }

        .list .btnList {
            height: 100%;
            float: left;
            border: 1px solid #337ab7;
            border-radius: 3px;
            border-right: none;
        }

        /*.list .btnList .btn0 {
                height: 100%;
                padding: 6px 17px;
                line-height: 22px;
                color: rgb(103,106,108);
                float: left;
                font-size: 14px;
                border-right: 1px solid #337ab7;
                cursor: pointer;
            }

                .list .btnList .btn0:hover {
                    color: #fff;
                    background: #286090;
                }

            .list .btnList .btn1,
            .list .btnList .btn2 {
                height: 100%;
                padding: 6px 17px;
                line-height: 22px;
                color: rgba(103,106,108,0.6);
                float: left;
                font-size: 14px;
                border-right: 1px solid #337ab7;
                cursor: no-drop;
            }

                .list .btnList .btn1:hover,
                .list .btnList .btn2:hover {
                    color: #fff;
                    background: #337ab7;
                    opacity: 0.6;
                }*/

        /*.list .btnList .btn11,
            .list .btnList .btn22 {
                height: 100%;
                padding: 6px 17px;
                line-height: 22px;
                color: rgb(103, 106, 108);
                float: left;
                font-size: 14px;
                border-right: 1px solid #337ab7;
                cursor: pointer;
            }

                .list .btnList .btn11:hover,
                .list .btnList .btn22:hover {
                    color: #fff;
                    background: #286090;
                }*/

        .list .query {
            float: right;
            height: 100%;
        }

            .list .query .input {
                float: left;
                height: 100%;
                width: 196px;
                border: 1px solid #337ab7;
                box-sizing: border-box;
                border-radius: 5px;
            }

                .list .query .input input {
                    width: 100%;
                    height: 100%;
                    padding: 6px 12px;
                    border-radius: 5px;
                    border: none;
                    color: #676a6c;
                    outline: none;
                }

            .list .query .btnQuery {
                float: left;
                height: 100%;
                padding: 6px 12px;
                line-height: 20px;
                border: 1px solid #337ab7;
                margin-left: 8px;
                border-radius: 3px;
                cursor: pointer;
            }

                .list .query .btnQuery:hover {
                    color: #fff;
                    background: #286090;
                }

    .tab {
        width: auto;
        /*border: 1px solid #adadad;*/
        border-radius: 5px;
        margin-top: 10px;
        margin-left: 15px;
        margin-right: 15px;
        overflow: auto;
    }

    #ModifyList, #AddList {
        position: absolute;
        width: 100%;
    }

        #ModifyList label, #AddList label {
            margin-top: 6px;
            /*padding: 6px;
        padding-left: 6px;*/
            padding-right: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background: #e6e6e6;
        }

        #ModifyList textarea, #AddList textarea {
            height: 82px;
        }

        #ModifyList input[type=checkbox], #AddList input[type=checkbox] {
            margin-top: 8px;
        }


        #AddList .addBtn, #ModifyList .editBtn {
            background: #337ab7;
            color: #fff;
            font-weight: bold;
        }

            #AddList .addBtn:hover, #ModifyList .editBtn:hover {
                background: #337ab7;
            }

    .hui {
        background: #F2F4F8;
    }
    /*#AddList ul{
        display: inline-block;
        float: left;

    }*/


    #s::-webkit-scrollbar{   /*滚动条样式*/
		            width: 3px;
		        }
		        #s::-webkit-scrollbar-thumb{
		            background: #337ab7;
		        }

    #sonTab {
        margin: 15px;
    }

    .hidden {
        display: none;
    }
</style>

<body>

    <div class="title">
        <i class="glyphicon glyphicon-tags">&nbsp;</i><span set-lan="html:"></span>
    </div>

    <div class="list">
        <div class="btnList">
            <!--<div class="btn0"><i class="glyphicon glyphicon-plus"></i><span set-lan="html:New">New</span></div>
            <div id="btn1" class="btn1" disabled="disabled"><i class="glyphicon glyphicon-pencil"></i><span set-lan="html:Edit">Edit</span></div>
            <div id="btn2" class="btn2"><i class="glyphicon glyphicon-trash"></i><span set-lan="html:Delete">Delete</span></div>-->
        </div>
        <div class="query">
            <div class="input">
                <input type="text" value="" placeholder="请输入SKUNO" />
            </div>
            <div class="btnQuery" set-lan="html:Query">
                Search
            </div>
        </div>
    </div>

    <div class="tab">
        <table></table>
    </div>

    <!--新增弹窗-->
    <div id="AddList" class="hidden">
        <div class="panel-body">
            <div class=" row">
                </br>

            </div>
        </div>
    </div>
    <!--修改弹窗-->
    <div id="ModifyList" class="hidden">
        <div class="panel-body">
            <div class="row">
                </br>



            </div>
        </div>
    </div>

</body>

<script>

var report = new ConfigReport({
	"pageMsg":{
		"pageName":"CheckLabel Config",
		"setLan":"CheckLabelConfig",
		"btnMsg":[
			{
				"id":"btn0",
				"btnName":"New",
				"icon":"glyphicon glyphicon-plus",    //图标样式
				"style":"0",  //任何时候可以点击
				"layerFlag":true    //点击该按钮是否弹出层
			},
			{
				"id":"btn1",
				"btnName":"Edit",
				"icon":"glyphicon glyphicon-pencil",
				"style":"1",  //只选中一条数据可以点击
				"layerFlag":true
			},
			{
				"id":"btn2",
				"btnName":"Delete",
				"icon":"glyphicon glyphicon-trash",
				"style":"1",  //选中多条数据都可以点击
				"layerFlag":false
			}
		],
	},
	"apiList":{
		"homePage":{   //首页
		    "className": "MESStation.Label.CheckLabelConfig",
		    "functionName": "GetAllCheckLabelConfig",
			"colList":[],
			"sendList":[]
		},
		"select":{
		    "className": "MESStation.Label.CheckLabelConfig",
		    "functionName": "GetAllCheckLabelConfig",
			"colList":[]
		},
		"add":{
		    "className": "MESStation.Label.CheckLabelConfig",
		    "functionName": "AddCheckLabelConfig",
			"colList":[]
		},
		"update":{
		    "className": "MESStation.Label.CheckLabelConfig",
			"functionName": "UpdateCheckLabelConfig",
			"colList":[]
		},
		"delete":{
		    "className": "MESStation.Label.CheckLabelConfig",
			"functionName": "DeleteCheckLabelConfig",
			"colList":[]
		},
		"layer":{

		}
	},

	"tableMsg":{     //表格各列
	    "column": ["SN", "WO", "SKUNO", "SKU_VER", "STATION_NAME", "SEQ_NO", "CATEGORY", "SCAN_NOTE", "SCAN_CONFIRM", "SCAN_QTY", "BLURRY", "EDIT_TIME", "EDIT_EMP"]
	},

	"layerMsg":{    //弹出框各项控件
		"add":{
			"showList":[
				{
				    "field": "SKUNO",    //字段名
					"type":"select",     //控件类型（text  select  checkbox  radio  textarea  ）
					"disabled": false
				},
				{
				    "field": "SKU_VER",
				    "type": "select",
				    "disabled": false
				},
				{
				    "field": "WO",
				    "type": "text",
				    "disabled": false
				},
				{
				    "field": "STATION_NAME",
				    "type": "text",
				    "disabled": false
				},
				{
					"field":"SSN",
					"type": "textarea",
					"disabled": false
				},
				//{
				//	"field":"xxx6",
				//	"type":"checkbox",
				//	"labelList":["val1","val2","val3","val1","val2","val3","val1","val2","val3"],
				//	"valList":["val1","val2","val3","val1","val2","val3","val1","val2","val3"]
				//},
				{
				    "field": "CATEGORY",  //产品类型
				    "type": "select",
				    "disabled": false
				},
                {
                    "field": "SCAN_NOTE",
                    "type": "text",   //提示
                    "disabled": false
                },
                {
                    "field": "SCAN_CONFIRM",   //所扫描实物内容
                    "type": "text",
                    "disabled": false
                },
                {
                    "field": "SCAN_QTY",  //掃描的Barcode次數
                    "type": "text",
                    "disabled": false
                },
				//{
				//	"field":"xxx6",
				//	"type":"radio",
				//	"labelList":["val1","val2","val3","val1","val2","val3","val1","val2","val3"],
				//	"valList":["val1","val2","val3","val1","val2","val3","val1","val2","val3"]
				//}
			],
			"sendList": [ "SKUNO", "SKU_VER","WO", "STATION_NAME","SSN", "CATEGORY", "SCAN_NOTE", "SCAN_CONFIRM", "SCAN_QTY"]
		},
		"edit":{
		    "showList": [
                {
                    "field": "SN",
                    "type": "text",
                    "disabled": true
                },
				{
				    "field": "SKUNO",    //字段名
				    "type": "text",     //控件类型（text  select  checkbox  radio  textarea  ）
                    "disabled":true
				},
				{
				    "field": "SKU_VER",
				    "type": "text",
				    "disabled": true
				},
				{
				    "field": "WO",
				    "type": "text",
				    "disabled": true
				},
		        {
		            "field": "STATION_NAME",
		            "type": "text",
		            "disabled": true
		        },
				

				//{
				//	"field":"xxx6",
				//	"type":"checkbox",
				//	"labelList":["val1","val2","val3","val1","val2","val3","val1","val2","val3"],
				//	"valList":["val1","val2","val3","val1","val2","val3","val1","val2","val3"]
				//},

				//{
				//	"field":"xxx6",
				//	"type":"radio",
				//	"labelList":["val1","val2","val3","val1","val2","val3","val1","val2","val3"],
				//	"valList":["val1","val2","val3","val1","val2","val3","val1","val2","val3"]
				//}
		    ],
		    "sendList": ["SN", "SKUNO", "SKU_VER", "WO", "STATION_NAME"]
		}

	},
	"loadLayerData":[       //加载特殊控件数据
		{
		    "field": "SKUNO",
			"type":"select",
			"className": "MESStation.Config.SkuConfig",
			"functionName": "GetAllSkuno",
            "pri":1       //优先级（1.绘制表格后就加载数据，2等别的数据加载后再加载数据）
		},

		{
		    "field": "SKU_VER",
		    "type": "select",
		    "className": "MESStation.WOManager.WOBaseConfig",
		    "functionName": "GetVersion",
		    "pri": 2
		},
        //{
        //    "field": "STATION_NAME",
        //    "type": "select",
        //    "className": "MESStation.Label.CheckLabelConfig",
        //    "functionName": "GetAllStation",

        //    "pri": 1
        //},
        {
            "field": "CATEGORY",
            "type": "select",
            "className": "MESStation.Label.CheckLabelConfig",
            "functionName": "GetCategory",
            "pri": 1
        }
	]
});


//////////////////////////////////////////////////////////////////////////////////////////////////////////////

/*
 *   基于jquery / bootstrap / bootstrap-table / layer / MesClient /
 *
 * */


function ConfigReport(o) {
    var _this = this;
	this.pageMsg = o.pageMsg;
	this.apiList = o.apiList;
	this.layerMsg = o.layerMsg;
	this.tableMsg = o.tableMsg;
	this.layerData = o.loadLayerData;
	ConfigReport.prototype.Init = function (){
		//生成报表网页基本结构(包括按钮)
		this.ReportHTML(this.pageMsg);
		//接收首页数据，show首页数据，回调
		self.parent.client.CallFunction(this.apiList["homePage"]["className"], this.apiList["homePage"]["functionName"], this.sendData(this.apiList["homePage"]["colList"], this.apiList["homePage"]["sendList"]), function (e) {
		    if (e.Status == "Pass") {
		        _this.InitCallback(e.Data);
		    }else{
		        _this.InitCallback([]);
		    }
		});
		//加载弹出层，生成控件，控制样式，
		this.loadLayer(this.layerMsg);
		//加载特殊控件内数据（下拉数据等），
		this.loadLayerData(this.layerData);
		//事件触发逻辑
		this.clickEvent();
	}
	ConfigReport.prototype.ReportHTML = function (obj){
		$(".title span").html(obj.pageName);                          //页面名
		$(".title span").attr("set-lan","html:" + obj.setLan);        //多语言
		this.generateBtn(obj.btnMsg);                                 //生成按钮
	}
	//生成按钮
	ConfigReport.prototype.generateBtn = function (arr){
		var btnContainer = $(".list .btnList");
		for(var i = 0; i < arr.length; i++){
			var div = $("<div id="+ arr[i]["id"] +" ></div>");
			var oi = $("<i></i>");
			var span = $("<span set-lan="+ arr[i]["btnName"] +"> "+ arr[i]["btnName"] +" </span>");
			oi.attr("class",arr[i]["icon"]);
			if(arr[i]["style"] == 0){   //设置按钮初始样式（选择数据后的按钮样式见表格生成处）
				div.css({
					"height":"100%",
					"padding":"6px 17px",
					"lineHeight":"22px",
					"color":"rgb(103,106,108)",
					"float":"left",
					"fontSize":"14px",
					"borderRight":"1px solid #337ab7",
					"cursor":"pointer"
				});
				div.hover(function (){   //移入
					$(this).css({
						"color":"#fff",
						"background":"#286090"
					});
				},function (){           //移出
					$(this).css({
						"color":"rgb(103,106,108)",
						"background":"#fff"
					});
				});
			}else{
				div.css({
					"height":"100%",
					"padding":"6px 17px",
					"lineHeight":"22px",
					"color":"rgba(103,106,108,0.6)",
					"float":"left",
					"fontSize":"14px",
					"borderRight":"1px solid #337ab7",
					"cursor":"no-drop"
				});
				div.hover(function (){   //移入
					$(this).css({
						"color":"#fff",
						"background":"#337ab7",
						"opacity":"0.6"
					});
				},function (){           //移出
					$(this).css({
						"color":"rgba(103,106,108,0.6)",
						"background":"#fff",
						"opacity":"1"
					});
				});
			}
			div.append(oi);
			div.append(span);
			btnContainer.append(div);
		}
	}
	ConfigReport.prototype.sendData = function (colList,sendList){       //生成发送数据
		var sendData = {};
		$.each(colList,function (i,val){
			sendData[val] = sendList[i];
		});
		return sendData;
	}

	ConfigReport.prototype.InitCallback= function (e) {
	    //show首页数据
	    $(".tab table").bootstrapTable({
	        data: e,   //e
	        pagination: true,    //分页显示
	        pageSize: 50,         //初始化每一页的数据条数
	        pageList: [50, 100, 200, 500],
	        search: false,        //显示查找框
	        striped: true,        //背景色相间
	        showRefresh: false,   //显示重置按钮
	        clickToSelect: true,   //单击一行内任意单元格选中该行
	        singleSelect: true,  //单选
	        onCheck: function (row) {   //选中
	            var btn1 = []; //1类按钮
	            var btn2 = []; //2类按钮
	            $.each(o.pageMsg["btnMsg"], function (index, val) {
	                if (val["style"] == 1) {
	                    btn1.push($("#" + val["id"]));
	                }
	                if (val["style"] == 2) {
	                    btn2.push($("#" + val["id"]));
	                }
	            })
	            var rows = $('.tab table').bootstrapTable('getAllSelections');  ///getAllSelections
	            if (rows.length == 1) {   //控制1类btn
	                $.each(btn1, function (index, ele) {
	                    ele.css({                 //初始
	                        "height": "100%",
	                        "padding": "6px 17px",
	                        "lineHeight": "22px",
	                        "color": "rgb(103, 106, 108)",
	                        "float": "left",
	                        "fontSize": "14px",
	                        "borderRight": "1px solid #337ab7",
	                        "cursor": "pointer"
	                    });
	                    ele.hover(function () {    //移入
	                        $(this).css({
	                            "color": "#fff",
	                            "background": "#286090",
	                            "opacity": "1"
	                        });
	                    }, function () {            //移出
	                        $(this).css({
	                            "color": "rgb(103, 106, 108)",
	                            "background": "#fff"
	                        });
	                    });
	                });
	            } else {
	                $.each(btn1, function (index, ele) {
	                    ele.css({                 //初始
	                        "height": "100%",
	                        "padding": "6px 17px",
	                        "lineHeight": "22px",
	                        "color": "rgba(103,106,108,0.6)",
	                        "float": "left",
	                        "fontSize": "14px",
	                        "borderRight": "1px solid #337ab7",
	                        "cursor": "no-drop"
	                    });
	                    ele.hover(function () {    //移入
	                        $(this).css({
	                            "color": "#fff",
	                            "background": "#337ab7",
	                            "opacity": "0.6"
	                        });
	                    }, function () {            //移出
	                        $(this).css({
	                            "color": "rgba(103,106,108,0.6)",
	                            "background": "#fff",
	                            "opacity": "1"
	                        });
	                    });
	                });
	            }
	            if (rows.length > 0) {    //控制2类btn
	                $.each(btn2, function (index, ele) {
	                    ele.css({                 //初始
	                        "height": "100%",
	                        "padding": "6px 17px",
	                        "lineHeight": "22px",
	                        "color": "rgb(103, 106, 108)",
	                        "float": "left",
	                        "fontSize": "14px",
	                        "borderRight": "1px solid #337ab7",
	                        "cursor": "pointer"
	                    });
	                    ele.hover(function () {    //移入
	                        $(this).css({
	                            "color": "#fff",
	                            "background": "#286090",
	                            "opacity": "1"
	                        });
	                    }, function () {            //移出
	                        $(this).css({
	                            "color": "rgb(103, 106, 108)",
	                            "background": "#fff"
	                        });
	                    });
	                });
	            } else {
	                $.each(btn2, function (index, ele) {
	                    ele.css({                 //初始
	                        "height": "100%",
	                        "padding": "6px 17px",
	                        "lineHeight": "22px",
	                        "color": "rgba(103,106,108,0.6)",
	                        "float": "left",
	                        "fontSize": "14px",
	                        "borderRight": "1px solid #337ab7",
	                        "cursor": "no-drop"
	                    });
	                    ele.hover(function () {    //移入
	                        $(this).css({
	                            "color": "#fff",
	                            "background": "#337ab7",
	                            "opacity": "0.6"
	                        });
	                    }, function () {            //移出
	                        $(this).css({
	                            "color": "rgba(103,106,108,0.6)",
	                            "background": "#fff",
	                            "opacity": "1"
	                        });
	                    });
	                });
	            }
	            checkedData = rows;
	        },
	        onUncheck: function (row) {  //取消选中
	            var btn1 = []; //1类按钮
	            var btn2 = []; //2类按钮
	            $.each(o.pageMsg["btnMsg"], function (index, val) {
	                if (val["style"] == 1) {
	                    btn1.push($("#" + val["id"]));
	                }
	                if (val["style"] == 2) {
	                    btn2.push($("#" + val["id"]));
	                }
	            })
	            var rows = $('.tab table').bootstrapTable('getAllSelections');  ///getAllSelections
	            if (rows.length == 1) {   //控制1类btn
	                $.each(btn1, function (index, ele) {
	                    ele.css({                 //初始
	                        "height": "100%",
	                        "padding": "6px 17px",
	                        "lineHeight": "22px",
	                        "color": "rgb(103, 106, 108)",
	                        "float": "left",
	                        "fontSize": "14px",
	                        "borderRight": "1px solid #337ab7",
	                        "cursor": "pointer"
	                    });
	                    ele.hover(function () {    //移入

	                        $(this).css({
	                            "color": "#fff",
	                            "background": "#286090",
	                            "opacity": "1"
	                        });
	                    }, function () {            //移出
	                        $(this).css({
	                            "color": "rgb(103, 106, 108)",
	                            "background": "#fff"
	                        });
	                    });
	                });
	            } else {
	                $.each(btn1, function (index, ele) {
	                    ele.css({                 //初始
	                        "height": "100%",
	                        "padding": "6px 17px",
	                        "lineHeight": "22px",
	                        "color": "rgba(103,106,108,0.6)",
	                        "float": "left",
	                        "fontSize": "14px",
	                        "borderRight": "1px solid #337ab7",
	                        "cursor": "no-drop"
	                    });
	                    ele.hover(function () {    //移入
	                        $(this).css({
	                            "color": "#fff",
	                            "background": "#337ab7",
	                            "opacity": "0.6"
	                        });
	                    }, function () {            //移出
	                        $(this).css({
	                            "color": "rgba(103,106,108,0.6)",
	                            "background": "#fff",
	                            "opacity": "1"
	                        });
	                    });
	                });
	            }
	            if (rows.length > 0) {    //控制2类btn
	                $.each(btn2, function (index, ele) {
	                    ele.css({                 //初始
	                        "height": "100%",
	                        "padding": "6px 17px",
	                        "lineHeight": "22px",
	                        "color": "rgb(103, 106, 108)",
	                        "float": "left",
	                        "fontSize": "14px",
	                        "borderRight": "1px solid #337ab7",
	                        "cursor": "pointer"
	                    });
	                    ele.hover(function () {    //移入

	                        $(this).css({
	                            "color": "#fff",
	                            "background": "#286090",
	                            "opacity": "1"
	                        });
	                    }, function () {            //移出
	                        $(this).css({
	                            "color": "rgb(103, 106, 108)",
	                            "background": "#fff"
	                        });
	                    });
	                });
	            } else {
	                $.each(btn2, function (index, ele) {
	                    ele.css({                 //初始
	                        "height": "100%",
	                        "padding": "6px 17px",
	                        "lineHeight": "22px",
	                        "color": "rgba(103,106,108,0.6)",
	                        "float": "left",
	                        "fontSize": "14px",
	                        "borderRight": "1px solid #337ab7",
	                        "cursor": "no-drop"
	                    });
	                    ele.hover(function () {    //移入
	                        $(this).css({
	                            "color": "#fff",
	                            "background": "#337ab7",
	                            "opacity": "0.6"
	                        });
	                    }, function () {            //移出
	                        $(this).css({
	                            "color": "rgba(103,106,108,0.6)",
	                            "background": "#fff",
	                            "opacity": "1"
	                        });
	                    });
	                });
	            }
	            checkedData = rows;
	        },
	        columns: this.columns(this.tableMsg["column"])
	    });
	    $(".tab table").find(".bs-checkbox").css({
	        "text-align": "center",
	        "vertical-align": "middle",
	    });
	    //配置语言
	    //this.setLanguage("CheckLabelConfig");
	}

	ConfigReport.prototype.setLanguage = function (page) {
	    var client = self.parent.client;
	    var MesUI = new MesClientUI(client);
	    MesUI.SetLanguage(page);
	}
	ConfigReport.prototype.columns = function (colList) {   //生成表格关键数据
		var columns = [];
		columns.push({
			align: 'center',
            valign: 'middle',
		    checkbox: true
		});
		$.each(colList,function (i,val){
			var title = "<label set-lan="+ "html:"+val+">"+val+"</label>";
			var obj = {
				field: val,
		        title: title,
		        align: 'center',
                valign: 'middle'
			};
			columns.push(obj);
		});
		return columns;
	}

	ConfigReport.prototype.loadLayer = function (layerMsg){
		var self = this;
		$.each(this.pageMsg.btnMsg,function (index,obj){  //遍历按钮
			if(obj.layerFlag){
				if(obj.btnName == "New"){    //$("#AddList")
					//console.log(layerMsg.add.showList,$("#AddList .panel-body .row"));
					$.each(layerMsg.add.showList,function (index,control){
						var ele = self.loadControl(control.field,control.type,control.disabled,control.labelList,control.valList);
						$("#AddList .panel-body .row").append(ele);
					});
					var odiv = $("<div></div>");
					var label = $("<div></div>");
					var div = $("<div class="+ "col-xs-4" +"></div>");
					var btn = $("<button>ADD</button>");
					btn.attr("class","form-control addBtn");
					label.attr("class","col-xs-4 control-label text-right");
					odiv.attr("class","ADD form-group col-sm-6 col-md-6 hui");
					div.append(btn);
					odiv.append(label);
					odiv.append(div);
					$("#AddList .panel-body .row").append(odiv);
				}
				if(obj.btnName == "Edit"){    //$("#ModifyList")
					$.each(layerMsg.edit.showList,function (index,control){
						var ele = self.loadControl(control.field,control.type,control.disabled,control.labelList,control.valList);
						$("#ModifyList .panel-body .row").append(ele);
					});
				    //加入表格   START   **************************************************************/
					var sonTab = $("<div id="+ "sonTab" +"><table></table></div>");
					$("#ModifyList .panel-body .row").append(sonTab);
					
				    //加入表格   END     ***************************************************************/

					//加入功能按键
					var odiv = $("<div></div>");
					var label = $("<div></div>");
					var div = $("<div class="+ "col-xs-4" +"></div>");
					var btn = $("<button>EDIT</button>");
					btn.attr("class","form-control editBtn");
					label.attr("class","col-xs-4 control-label text-right");
					odiv.attr("class","EDIT form-group col-sm-6 col-md-6 hui");
					div.append(btn);
					odiv.append(label);
					odiv.append(div);
					$("#ModifyList .panel-body .row").append(odiv);
				}
			}
		});
	}
	ConfigReport.prototype.loadControl = function (name, type, disabled, labelList, valList) {   //加载弹出层控件（单个控件）labelList,valList针对单选框，复选框有用
	    var ele;
		switch(type){
			case "text":
				ele = $("<div></div>");
				var label = $("<label set-lan="+ "html:" + name +">"+ name +"</label>");
				var div = $("<div class="+ "col-xs-8" +"></div>");
				var oInput ;
				if (disabled) {
				    oInput = $("<input type=" + "text" + " class=" + "form-control" + " id=" + name + " name=" + name + " disabled />");
				} else {
				    oInput = $("<input type=" + "text" + " class=" + "form-control" + " id=" + name + " name=" + name + " />");
				}
				label.attr("class","col-xs-4 control-label text-right");
				ele.attr("class","form-group col-sm-6 col-md-6 hui");
				div.append(oInput);
				ele.append(label);
				ele.append(div);
				break;
			case "select":
				ele = $("<div></div>");
				var label = $("<label set-lan="+ "html:" + name +">"+ name +"</label>");
				var div = $("<div class="+ "col-xs-8" +"></div>");
				var oSelect = $("<select name="+ name +" id="+ name +" class="+ "form-control" +" ></select>");
				label.attr("class","col-xs-4 control-label text-right");
				ele.attr("class","form-group col-sm-6 col-md-6 hui");
				div.append(oSelect);
				ele.append(label);
				ele.append(div);
				break;
			case "textarea":
				ele = $("<div></div>");
				var label = $("<label set-lan="+ "html:" + name +">"+ name +"</label>");
				var div = $("<div class="+ "col-xs-8" +"></div>");
				var oTextarea = $("<textarea name="+ name +" id="+ name +" class="+ "form-control" +" ></textarea>");
				label.attr("class","col-xs-4 control-label text-right");
				ele.attr("class","form-group col-sm-6 col-md-6 hui");
				div.append(oTextarea);
				ele.append(label);
				ele.append(div);
				break;
			case "file":
				break;
			case "checkbox":
				ele = $("<div></div>");
				var label = $("<label set-lan="+ "html:" + name +">"+ name +"</label>");
				var div = $("<div class="+ "col-xs-8" +"></div>");
				var odiv;
				$.each(labelList,function (index,val){
					odiv = $("<div class="+ "col-xs-4" +"></div>");
					var span = $("<span>" + val + " : " +"</span>");
					var oinput = $("<input type="+ "checkbox" +" value="+ valList[index] +" name="+ name +" />");
					odiv.append(span);
					odiv.append(oinput);
					div.append(odiv);
				});
				label.attr("class","col-xs-4 control-label text-right");
				ele.attr("class","form-group col-sm-6 col-md-6 hui");
				ele.append(label);
				ele.append(div);
				break;
			case "radio":
				ele = $("<div></div>");
				var label = $("<label set-lan="+ "html:" + name +">"+ name +"</label>");
				var div = $("<div class="+ "col-xs-8" +"></div>");
				var odiv;
				$.each(labelList,function (index,val){
					odiv = $("<div class="+ "col-xs-4" +"></div>");
					var span = $("<span>" + val + " : " +"</span>");
					var oinput = $("<input type="+ "radio" +" value="+ valList[index] +" name="+ name +" />");
					odiv.append(span);
					odiv.append(oinput);
					div.append(odiv);
				});
				label.attr("class","col-xs-4 control-label text-right");
				ele.attr("class","form-group col-sm-6 col-md-6 hui");
				ele.append(label);
				ele.append(div);
				break;
		}
		return ele;
	}
	ConfigReport.prototype.loadLayerData = function (layerData){    //加载弹出层数据
		//console.log(layerData);
	    //console.log(this.layerMsg);
		$.each(layerData, function (index, dataObj) {
		    if (dataObj["pri"] == 1 && dataObj["type"] == "select") {      //加载第一优先的下拉数据
		        var container = $("select[name=" + dataObj.field + "]");   //根据name值找元素
		        //console.log(container);
		        self.parent.client.CallFunction(dataObj["className"], dataObj["functionName"], {}, function (e) {
		            if(e.Status == "Pass"){
		                loadSelectData(container,e.Data);
		            }
		        })
		    }
		});
		$("input[name=STATION_NAME]").on("input", throttle(function (ev,createSelect) {     //this:该输入框 创建下拉框结构
		    var $ipt = $(this);
		    var skuno = $("select[name=SKUNO]").val();
		    var sendData = {
		        SKUNO: skuno,
		        STATION_NAME:""
		    };
		    if (/,/g.test($ipt.val())) {   //包含，
		        sendData.STATION_NAME = $ipt.val().match(/,[^,]*$/)[0].replace(/,/, "").toUpperCase();
		    } else {
		        sendData.STATION_NAME = $ipt.val().toUpperCase();
		    }
		    self.parent.client.CallFunction("MESStation.Label.CheckLabelConfig", "GetStationBySkuno", sendData, function (e) {   //GetAllStation
		        $("#s").remove();
		        if (e.Status == "Pass" && Object.prototype.toString.call(e.Data) == "[object Array]" && e.Data.length > 0) {
		            
		            createSelect($ipt, e.Data);
		            $("#s").find("li").on("click", function () {
		                var str;
		                if ($ipt.val().replace(/,([^,]*)$/, "") == "" || !(/,/g.test($ipt.val()))) {
		                    str = $(this).text() + ",";
		                } else {
		                    str = $ipt.val().replace(/,([^,]*)$/, "") + "," + $(this).text() + ",";
		                }
		                $ipt.val(str);
		                $("#s").css("display", "none");
		                $ipt.focus();
		            });
		            $ipt.off("click");
		            $("#AddList").parent().off("click");
		            $ipt.on("click", function () {
		                $("#s").css("display", "none");
		            });
		            $("#AddList").parent().on("click", function () {
		                $ipt.val($ipt.val().replace(/,([^,]*)$/, ","));
		                $("#s").css("display", "none");
		            })
		        }
		    });
		}, 500));


	    //加载第二优先的数据************************START**************************************/

		$("select[name=SKUNO]").on("change", function () {
		    self.parent.client.CallFunction(field_api("SKU_VER")["className"], field_api("SKU_VER")["functionName"], {"SKUNO":this.value}, function (e) {
		        if(e.Status == "Pass"){
		            loadSelectData($("select[name=SKU_VER]"), e.Data);
		            $("input[name=STATION_NAME]").val("");
		        }
		    });
		});

	    //加载第二优先的数据**********************END****************************************/

		function field_api(field) {    //根据字段（field）找api信息，dataList:配置数据 该函数为非纯函数
		    var obj = {};
		    $.each(layerData, function (index, dataObj) {
		        if (dataObj["pri"] == 2 && dataObj["field"] == field) {
		            obj = dataObj;
		        }
		    });
		    return obj;
		}
		
		function throttle(method, delay) {
		    var timer = null;
		    return function () {
		        var _this = this;
		        var _args = arguments;
		        [].push.call(_args, createSelect);
		        clearTimeout(timer);
		        timer = setTimeout(function () {
		            method.apply(_this,_args);
		        }, delay);
		    }
		    function createSelect($ipt, selectData) {     //创建下拉框    $ipt：输入框 ,selectData：下拉数据
		        $ipt.css("position","relative");
		        var s = $("<div class=" + "form-group" + " id=" + "s" + "></div>");
		        var ul = $("<ul></ul>");
		        var len = selectData.length;
		        s.css({
		            position: "absolute",
		            top: "34px",
		            left: "15px",
                    zIndex:"11111",
		            width: $ipt.css("width"),
		            border: "1px solid #337ab7",
                    borderRadius:"3px",
                    background: "#fff",
                    overflowX: "hidden",
                    overflowY:"auto"
		        });
		        if (len <= 10) {
		            s.css("height", 24 * len + "px");
		        } else {
		            s.css("height", "240px");
		        }
		        ul.css({
		            padding: "0px",
		            width: "100%",
                    marginBottom:"0px"
		        });
		        ul.html("");
		        $.each(selectData, function (index, val) {
		            var li = $("<li>"+ val +"</li>");
		            li.css({
		                width: "100%",
		                height: "24px",
		                lineHeight: "24px",
		                fontSize: "10px",
		                padding: "0px 10px",
                        overflow:"hidden",
		                whiteSpace: "nowrap",
		                textOverflow: "ellipsis",
                        listStyle:"none"
		            });
		            ul.append(li);
		        });
		        s.append(ul);
		        $ipt.after(s);
		        ul.find("li").hover(function () {   //鼠标移入
		            $(this).css({
		                background: "#337ab7",
                        color:"#fff"
		            });
		        }, function () {    //鼠标移出
		            $(this).css({
		                background: "#fff",
		                color: "#000"
		            });
		        });
		        window.onresize = function () {
		            s.css("width", $ipt.css("width"));  //Number($ipt.css("width").replace("px", ""))+ 26 + "px"
		        }


		    }
		}

		function loadSelectData(container, dataList) {     //加载下拉框数据
		    //console.log(container, dataList);
		    container.html(" ");
		    $.each(dataList, function (index, val) {
		        var op = $("<option value=" + val + ">" + val + "</option>");
		        container.append(op);
		    });
		}
	}
	ConfigReport.prototype.clickEvent = function () {
	    var _this = this;     //_this.layerMsg.add.sendList _this.apiList.add 发送列
		$.each(this.pageMsg.btnMsg,function (index,btn){
			$("#"+ btn.id).on("click",function (){
				if(btn.btnName == "New"){
					layer.open({
		            	type: 1,
		            	skin: "layui-layer-lan",
		            	title: 'New Data',
		            	area: ["80%", "90%"],
		           	 	scrollbar: false,
		            	content: $("#AddList"),
		            	maxmin: true,
		            	success: function (layero, index) {

		            	    var lay = layero;
		            	    var w = lay.css("width");
		            	    var h = lay.css("height");

		            	    lay.css({
		            	        position: "fixed",
		            	        left: "50%",
		            	        top: "50%",
		            	        marginTop: -Number(h.match(/\d+/g)) / 2 + "px",
		            	        marginLeft: -Number(w.match(/\d+/g)) / 2 + "px",
		            	    });
		            	    var nav = lay.children().eq(0);
		            	    nav.off("mousedown");
		            	    nav.off("mousemove");
		            	    nav.off("mouseup");
		            	    nav.off("click");

		            	    $("#AddList").removeClass("hidden");        //显示弹出框
		            	    $(".ADD button").on("click", function () {    //单击新增数据按钮
		            	        console.log(_this.layerMsg.add.sendList);
		            	        var sendData = {};
		            	        $.each(_this.layerMsg.add.sendList, function (index, val) {
		            	            sendData[val] = get_val(val, $("#AddList"));         //$("#AddList").find("[name=" + val + "]").val();
		            	        });
		            	        console.log(sendData);
		            	        self.parent.client.CallFunction(_this.apiList.add["className"], _this.apiList.add["functionName"], sendData, function (e) {
		            	            if (e.Status == "Pass") {
		            	                layer.msg("已插入1条数据!", {
		            	                    icon: 1,
		            	                    time: 2000
		            	                }, function () {
		            	                    location.reload();
		            	                });
		            	            } else {
		            	                layer.msg("插入数据失败!", {
		            	                    icon: 0,
		            	                    time: 2000
		            	                }, function () {
		            	                });
		            	            }
		            	        });
		                	});
		            	},
		            	end: function () {
		                	$("#AddList").addClass("hidden");                                       //隐藏弹出框
		                	$(".panel-body").find("input").each(function (index, node) {     //关闭弹出框各项数据置空
		                   	 	node.value = "";
		                	});
		            	}
		       		});
		       	}
				if(btn.btnName == "Edit"){
					//console.log($(this).css("cursor") == "no-drop");
					if($(this).css("cursor") != "no-drop"){   //可交互状态
						layer.open({
		            		type: 1,
		            		skin: "layui-layer-lan",
		            		title: 'Edit Data',
		            		area: ["80%", "90%"],
		            		scrollbar: false,
		           		 	content: $("#ModifyList"),
		            		maxmin: true,
		            		success: function (layero, index) {

		            		    var lay = layero;
		            		    var w = lay.css("width");
		            		    var h = lay.css("height");

		            		    lay.css({
		            		        position: "fixed",
		            		        left: "50%",
		            		        top: "50%",
		            		        marginTop: -Number(h.match(/\d+/g)) / 2 + "px",
		            		        marginLeft: -Number(w.match(/\d+/g)) / 2 + "px",
		            		    });
		            		    var nav = lay.children().eq(0);
		            		    nav.off("mousedown");
		            		    nav.off("mousemove");
		            		    nav.off("mouseup");
		            		    nav.off("click");

		            		    //显示弹出框
		            		    $("#ModifyList").removeClass("hidden");
                                //插入表格
		            		    $("#sonTab table").bootstrapTable({
		            		        data: [],   //e
		            		        pagination: true,    //分页显示
		            		        pageSize: 10,         //初始化每一页的数据条数
		            		        pageList: [10, 25, 50, 100],
		            		        search: false,        //显示查找框
		            		        striped: true,        //背景色相间
		            		        showRefresh: false,   //显示重置按钮
		            		        clickToSelect: true,   //单击一行内任意单元格选中该行
		            		        singleSelect: false,  //单选
		            		        //onCheck: function (row) {   //选中
		            		        //    var rows = $('.tab table').bootstrapTable('getAllSelections');  ///getAllSelections
		            		        //},
		            		        //onUncheck: function (row) {  //取消选中
		            		        //    var rows = $('.tab table').bootstrapTable('getAllSelections');  ///getAllSelections
		            		        //    checkedData = rows;
		            		        //},
		            		        columns: [
                                    //    {
                                    //    align: 'center',
                                    //    valign: 'middle',
                                    //    checkbox: true
                                    //},
                                    {  //SEQ_NO SCAN_NOTE SCAN_CONFIRM SCAN_QTY
                                        field: 'SEQ_NO',
                                        title: '<span set-lan="html:SEQ_NO">SEQ_NO</span>',
                                        align: 'center',
                                        valign: 'middle'
                                    }, {
                                        field: 'SCAN_NOTE',
                                        title: '<span set-lan="html:SCAN_NOTE">SCAN_NOTE</span>',
                                        align: 'center',
                                        valign: 'middle'
                                    }, {
                                        field: 'SCAN_CONFIRM',
                                        title: '<span set-lan="html:SCAN_CONFIRM">SCAN_CONFIRM</span>',
                                        align: 'center',
                                        valign: 'middle'
                                    }, {
                                        field: 'SCAN_QTY',
                                        title: '<span set-lan="html:SCAN_QTY">SCAN_QTY</span>',
                                        align: 'center',
                                        valign: 'middle'
                                    }]
		            		    });
		            		    $(".tab table").find(".bs-checkbox").css({
		            		        "text-align": "center",
		            		        "vertical-align": "middle",
		            		    });
                                //显示填充数据
		                		//console.log($('.tab table').bootstrapTable('getAllSelections'));
		                		var sendData = showControlData([
                                    {
                                        "field": "SN",   //字段名
                                        "dataKey":"SN"  //字段对应的对象键
                                    },
                                    {
                                        "field": "SKUNO",
                                        "dataKey": "SKUNO"
                                    },
                                    {
                                        "field": "SKU_VER",
                                        "dataKey": "SKU_VER"
                                    },
                                    {
                                        "field": "WO",
                                        "dataKey": "WO"
                                    },
                                    {
                                        "field": "STATION_NAME",
                                        "dataKey": "STATION_NAME"
                                    }
		                		], $('.tab table').bootstrapTable('getAllSelections')[0]);
		            		    //处理发送数据，获取子表数据
		                		console.log(sendData);
		                		self.parent.client.CallFunction("MESStation.Label.CheckLabelConfig", "GetLabelInfor", sendData, function (e) {
		                		    console.log(e);
		                		    if (e.Status == "Pass") {    //Pass
		            		            $("#sonTab table").bootstrapTable("load", e.Data);     //e.Data
		            		            var trLen = $("#sonTab").find("tr").length;
		            		            var newTrNode = [];    //选中的td
		            		            $("#sonTab").find("tr").each(function (index, trNode) {
		            		                if (index != 0 && index != trLen - 1) {
		            		                    var trArr = [];
		            		                    $(trNode).find("td").each(function (index, tdNode) {
		            		                        if (index != 0) {
		            		                            trArr.push($(tdNode));   //$(tdNode)
		            		                            //console.log(tdNode);
		            		                        }
		            		                    });
		            		                    newTrNode.push(trArr);
		            		                }
		            		            });
		            		            $.each(newTrNode, function (index, trArr) {
		            		                $.each(trArr, function (i, td) {
		            		                    var val = td.html();
		            		                    //console.log(val);
		            		                    td.html("<input value=" + val + " />");
		            		                    td.find("input").css({
		            		                        "paddingLeft": "10px",
		            		                        "paddingRight": "10px"
		            		                    });
		            		                });
		            		            });
		            		        }
		            		    });
		                		//点击修改数据
		                		$(".EDIT button").on("click", function () {
		                		    sendData["tableList"] = [];
		                		    var trList = $("#sonTab table");//find("tr")
		                		    Array.prototype.shift.call(trList);   //去掉最前面的一项
		                		    Array.prototype.pop.call(trList);   //去掉最后面的一项
		                		    console.log(trList);
		                		    var trDetail = $(trList[0]).find("tr");
		                		    Array.prototype.shift.call(trDetail);
		                		    $.each(trDetail, function (indexs, tr) {
		                		        var obj = {};
		                		            $(tr).find("td").each(function (index, td) {
		                		                switch (index) {
		                		                    case 0:
		                		                        obj["SEQ_NO"] = $(td).html();
		                		                        break;
		                		                    case 1:
		                		                        obj["SCAN_NOTE"] = $(td).find("input").val();
		                		                        break;
		                		                    case 2:
		                		                        obj["SCAN_CONFIRM"] = $(td).find("input").val();
		                		                        break;
		                		                    case 3:
		                		                        obj["SCAN_QTY"] = $(td).find("input").val();
		                		                        break;
		                		                }
		                		            });
		                		            sendData["tableList"].push(obj);
		                		    });
		                		    console.log(sendData);
		                		    self.parent.client.CallFunction("MESStation.Label.CheckLabelConfig", "UpdateCheckLabelConfig", sendData, function (e) {
		                		        if (e.Status == "Pass") {
		                		            layer.msg(e.Message, {
		                		                icon: 1,
		                		                time: 2000
		                		            }, function () {
		                		                location.reload();
		                		            });
		                		        } else {
		                		            layer.msg(e.Message, {
		                		                icon: 0,
		                		                time: 2000
		                		            }, function () {
		                		            });
		                		        }
		                		    });
		                		});

		            		    //函数
		                		function showControlData(fieldArr,dataObj) {     //显示控件的数据，且返回需要的数据
		                		    var sendData = {};
		                		    $.each(fieldArr, function (index, obj) {
		                		        var control = $("#ModifyList").find("[name=" + obj["field"] + "]");   //字段对应的控件
		                		        control[0].value = dataObj[obj["dataKey"]];
		                		        sendData[obj["field"]] = dataObj[obj["dataKey"]];
		                		    });
		                		    return sendData;
		                		}
		            		},
		            		end: function () {
		                		$("#ModifyList").addClass("hidden");                                       //隐藏弹出框
		                		$(".panel-body").find("input").each(function (index, node) {     //关闭弹出框各项数据置空
		                    		node.value = "";
		                		});
		                		$("#sonTab").html("<table></table>");
		                		//console.log($("#sonTab"));
		            		}
						});
					}
				}
				if (btn.btnName == "Delete") {
				    if ($(this).css("cursor") != "no-drop") {   //可交互状态
				        layer.open({                          //确定是否删除?
				            title: 'Warning',
				            btn: ['Delete', 'Cancel'],
				            content: "Delete operation cannot be rolled back! </br> Are you sure you want to delete these records?",
				            yes: function (index) {      //确定删除
				                layer.close(index);        //关闭该选择layer框
				                var checkedData = $('.tab table').bootstrapTable('getAllSelections');
				                console.log(checkedData);
				                console.log();
				                self.parent.client.CallFunction(_this.apiList.delete["className"], _this.apiList.delete["functionName"], { "ID": checkedData[0]["ID"]}, function (e) {
				                    if (e.Status == "Pass") {
				                        layer.msg("已删除1条数据!", {
				                            icon: 1,
				                            time: 2000
				                        }, function () {
				                            location.reload();
				                        });
				                    } else {
				                        layer.msg("删除数据失败!", {
				                            icon: 0,
				                            time: 2000
				                        }, function () {
				                            location.reload();
				                        });
				                    }
				                });
				            }
				        });
				    }

				}
			});
		});

	    //查询
		$(".btnQuery").on("click", function () {
		    console.log($(".query input").val());
		    self.parent.client.CallFunction(_this.apiList.select["className"], _this.apiList.select["functionName"], { "SKUNO": $(".query input").val() }, function (e) {
		        if(e.Status == "Pass"){
		            $(".tab table").bootstrapTable("load",e.Data);
		        }
		    });
		});

        //函数（处理数据）
		function get_val(field, container) {     //用于生成发送数据
		    var val = container.find("[name=" + field + "]").val();
		    if (container.find("[name=" + field + "]").attr("name") == "STATION_NAME") {
		        val = val.replace(/,$/, "").split(",");
		    }
		    if (container.find("[name=" + field + "]")[0].tagName == "TEXTAREA" && val != null) {    //处理TEXTAREA框内数据，字符串变数组
		        val = val.split(/ +|,+|\n+/m);
		        var newVal = [];
		        $.each(val, function (index,value) {
		            if (value != "") {
		                newVal.push(value);
		            }
		        });
		        val = newVal;
		    }
		    return val;
		}
	};
	this.Init();
}

</script>

</html>
